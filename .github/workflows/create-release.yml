name: Create Release with Book Files

on:
  workflow_run:
    workflows: ["Render and Deploy Book"]
    types:
      - completed
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v1.0.0)'
        required: true
        default: 'v1.0.0'

jobs:
  create-release:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download PDF artifact
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: render-book.yml
          name: book-pdf
          path: ./releases
          
      - name: Download EPUB artifact 
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: render-book.yml
          name: book-epub
          path: ./releases

      - name: Get current date
        id: date
        run: echo "date=$(date +'%Y-%m-%d')" >> $GITHUB_OUTPUT

      - name: Create Release
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          VERSION="${{ github.event.inputs.version || 'latest' }}"
          DATE="${{ steps.date.outputs.date }}"
          
          # Create release with notes
          gh release create "$VERSION" \
            --title "The Shadow of Extremism - $DATE" \
            --notes "## The Shadow of Extremism
          
          **A 2-day AI experiment**: Created using Google Antigravity (Gemini 2.0 Flash Thinking) + Claude
          
          ### What's Included
          - üìï PDF version (optimized for printing/e-readers)
          - üì± EPUB version (for mobile devices)
          - üåê Online version: https://algiras.github.io/the-shadow-of-extremism/
          
          ### The Book
          A 200-page comparative analysis of Religious extremism across Christianity, Islam, Buddhism, Hinduism, and other traditions. Identifies 5 universal dynamics that drive extremist movements.
          
          ### The Experiment
          - **Timeline**: 2 days (48 hours)
          - **Tool**: Google Antigravity (free tier)
          - **Method**: AI-driven research with human curation
          - **Cost**: \$0
          
          ---
          
          *Read more about the methodology: https://github.com/Algiras/the-shadow-of-extremism/wiki*" \
            ./releases/*.pdf \
            ./releases/*.epub
